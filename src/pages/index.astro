---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import ProjectCard from "@components/ProjectCard.astro";
import Link from "@components/Link.astro";
import Preamble from "@components/Preamble.astro";
import RichText from "@components/RichText.astro";
import SectionHeading from "@components/SectionHeading.astro";
import { SITE, HOME } from "@consts";
import { home } from "@i18n/en";
import portrait from "@assets/portrait.jpeg";

const recentPosts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort(
    (first, second) => second.data.date.valueOf() - first.data.date.valueOf(),
  )
  .slice(0, SITE.NUMBER_OF_POSTS_ON_HOMEPAGE);

const recentProjects = (await getCollection("projects"))
  .filter((project) => !project.data.draft)
  .sort(
    (first, second) => second.data.date.valueOf() - first.data.date.valueOf(),
  )
  .slice(0, SITE.NUMBER_OF_PROJECTS_ON_HOMEPAGE);
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <div class="space-y-10 sm:space-y-16">
      <section class="animate">
        <div
          class="flex flex-col sm:flex-row gap-8 sm:gap-10 items-center sm:items-center"
        >
          <Image
            src={portrait}
            alt={home.portraitAlt}
            width={176}
            height={176}
            class="w-36 h-36 sm:w-44 sm:h-44 rounded-full object-cover shrink-0"
          />
          <div class="text-center sm:text-left min-w-0 font-mono">
            <p class="font-semibold text-lg">
              <span id="greeting-wrapper" style="color: var(--greeting-color-0)"
                ><span
                  id="greeting"
                  class="greeting-gradient"
                  style="background-image: var(--greeting-grad-0)">Hej!</span
                ><span id="typewriter-cursor" class="cursor-blink"></span></span
              >
            </p>
            <p
              class="mt-2 font-semibold text-lg text-tn-light-fg dark:text-tn-dark-fg"
            >
              I'm {home.intro.nameFirst}
              <span
                class="font-normal text-tn-light-fg-muted dark:text-tn-dark-fg-muted"
                >{home.intro.nameLast}</span
              >.
            </p>
            <div class="space-y-1 mt-2">
              <p class="text-sm whitespace-nowrap">
                I'm a {home.intro.role} at <Link
                  href={home.intro.employer.href}
                  external
                  ><span class="group/dc"
                    >{home.intro.employer.abbreviation.charAt(0)}<span
                      class="unfold-text"
                      >{
                        home.intro.employer.name.split(" ")[0].slice(1)
                      }&nbsp;</span
                    >{home.intro.employer.abbreviation.charAt(1)}<span
                      class="unfold-text"
                      >{home.intro.employer.name.split(" ")[1].slice(1)}</span
                    ></span
                  ></Link
                >
              </p>
              <p class="text-sm whitespace-nowrap">
                with an {home.intro.university.degreeLabel} from <Link
                  href={home.intro.university.href}
                  external
                  ><span class="group/au"
                    >{home.intro.university.abbreviation.charAt(0)}<span
                      class="unfold-text"
                      >{
                        home.intro.university.name.split(" ")[0].slice(1)
                      }&nbsp;</span
                    >{home.intro.university.abbreviation.charAt(1)}<span
                      class="unfold-text"
                      >{home.intro.university.name.split(" ")[1].slice(1)}</span
                    ></span
                  ></Link
                >.
              </p>
            </div>
          </div>
        </div>
        <article class="mt-6 space-y-4">
          <Preamble>{home.bio}</Preamble>
          <p>
            {home.interests}
          </p>
        </article>
      </section>

      {
        recentPosts.length > 0 && (
          <section class="animate space-y-4 sm:space-y-6">
            <div class="flex flex-wrap gap-y-2 items-center justify-between">
              <SectionHeading color="accent">
                {home.sections.latestPosts}
              </SectionHeading>
              <Link href="/blog">{home.sections.seeAllPosts}</Link>
            </div>
            <ul class="flex flex-col gap-3">
              {recentPosts.map((post, index) => (
                <li>
                  <ArrowCard entry={post} index={index} />
                </li>
              ))}
            </ul>
          </section>
        )
      }

      <section class="animate space-y-4 sm:space-y-6">
        <div class="flex flex-wrap gap-y-2 items-center justify-between">
          <SectionHeading color="green">{home.sections.projects}</SectionHeading
          >
          <Link href="/projects">{home.sections.seeAllProjects}</Link>
        </div>
        <ul class="flex flex-col gap-3">
          {
            recentProjects.map((project, index) => (
              <li>
                <ProjectCard entry={project} index={index} />
              </li>
            ))
          }
        </ul>
      </section>

      <section class="animate space-y-4">
        <SectionHeading color="orange">{home.sections.connect}</SectionHeading>
        <article>
          <p>
            <RichText segments={home.connect} />
          </p>
        </article>
      </section>
    </div>
  </Container>
</PageLayout>
